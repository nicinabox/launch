#!/usr/bin/env ruby

require 'json'

class Launch
  def initialize(service)
    case service
    when 'list'
      all_services
    else
      open(service)
    end
  end

  def config
    ENV['HOME'] ||= File.expand_path('~')
    @config ||= JSON.parse(File.read("#{ENV['HOME']}/.launchrc"))
  end

  def all_services
    services = config['services']
    puts services.keys
  end

  def open(service)
    services = config['services']
    aliases  = config['aliases']

    service = aliases[service] if aliases.include? service
    port = services[service]

    puts "Launching #{service}"

    if /^:/ =~ port
      `open http://#{config['host']}#{port}`
    else
      `open http://#{port}`
    end
  end
end

Launch.new ARGV[0] || ''
